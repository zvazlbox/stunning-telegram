<html>

<head>
    <meta charset="utf-8">
    <title>
        短网址
    </title>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="/static/uikit.min.css"/>

    <!-- UIkit JS -->
    <script src="/static/jquery-3.4.1.min.js"></script>
    <script src="/static/uikit.min.js"></script>
    <script src="/static/uikit-icons.min.js"></script>
    <script src="/static/qrcode.js"></script>
    <script src="/static/jquery.qrcode.js"></script>
</head>

<body>
<div uk-sticky="media: 960"
     class="uk-navbar-container tm-navbar-container uk-sticky uk-active uk-sticky-below uk-sticky-fixed"
     style="position: fixed; top: 0px; width: 1280px;">
    <div class="uk-container uk-container-expand">
        <nav class="uk-navbar">
            <div class="uk-navbar-left">
                <a href="/" class="uk-navbar-item uk-logo">
                    <svg width="28" height="34" viewBox="0 0 28 34" xmlns="http://www.w3.org/2000/svg"
                         class="uk-margin-small-right uk-svg">
                        <polygon fill="#fff" points="19.1,4.1 13.75,1 8.17,4.45 13.6,7.44 "></polygon>
                        <path fill="#fff"
                              d="M21.67,5.43l-5.53,3.34l6.26,3.63v9.52l-8.44,4.76L5.6,21.93v-7.38L0,11.7v13.51l13.75,8.08L28,25.21V9.07 L21.67,5.43z"></path>
                    </svg>
                    短网址
                </a></div>

            <div class="uk-navbar-right">
                <ul class="uk-navbar-nav uk-visible@m">
                    <li><a href="#api">开放Api</a></li>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</div>

<div class="uk-container uk-container-small uk-position-relative uk-padding-large">
    <h2>短链接</h2>
    <form>
        <fieldset class="uk-fieldset">
            <legend class="uk-legend">输入将要缩短的长网址</legend>

            <div class="uk-margin">
                <input id="url" class="uk-input" type="text" placeholder="http://">
            </div>

            <legend class="uk-legend">自定义短语(选填)</legend>

            <div class="uk-margin">
                <input id="short" class="uk-input" type="text" placeholder="">
            </div>

            <p uk-margin>
                <button type="button" class="uk-button uk-button-primary" id="isub">提交</button>
            </p>

            <dl class="uk-description-list" id="detail" style="display: none">
                <dt>短网址地址:</dt>
                <dd><a target="_blank" href="#" id="addr"></a></dd>
                <dt>二维码:</dt>
                <dd>
                    <div id="qrcode"></div>
                </dd>
            </dl>

        </fieldset>
    </form>

    <hr class="uk-divider-icon">

    <div>
        <h2>书签</h2>
        <p>直接将下面红色按钮,拖放到你的浏览器收藏夹工具栏中, 点击即可</p>

        <a class="uk-button uk-button-danger"
           href="javascript:    (function () {
        var href = window.location.href;
        window.open('https://go.aamm.top/static?url=' + encodeURIComponent(href));
        })()">短链接工具</a>
    </div>
    <hr class="uk-divider-icon">

    <div id="api">
        <h2>接口API</h2>
        <p>
            直接调用
        <ul>
            <li>参数 url 链接地址</li>
            <li>参数 short 自定义短链接(可选)</li>
        </ul>
        <code>
            get https://go.aamm.top/url/short/add?url=encodeURIComponent("http://baidu.com")&short=baidu
        </code>
        </p>
    </div>
</div>

<script type="application/javascript">
    $(document).ready(function () {
        $("#isub").click(function () {

            var url = $("#url").val();
            url = url.trim();
            url = encodeURIComponent(url);
            console.log(url);

            var short = $("#short").val();
            short = short.trim();
            short = short.replace(" ", "").replace(/[\'\"\\\/\b\f\n\r\t]/g, '').replace(/[\-\_\,\!\|\~\`\(\)\#\$\%\^\&\*\{\}\:\;\"\L\<\>\?]/g, '');

            if (url.length <= 0) {
                alert("请填写url地址");
                return
            }

            $("#addr").val("");
            $('#qrcode').val("");

            $.get("/url/short/add?url=" + url + "&short=" + short, function (data) {

                if (data.code == 0) {
                    $("#detail").show();
                    var shortUrl = data.data.short;

                    $("#addr").attr("href", shortUrl);
                    $("#addr").text(shortUrl);
                    $('#qrcode').qrcode(shortUrl);

                } else {
                    alert(data.message);
                }
            });
        });

        var urlParams = new URLSearchParams(window.location.search);
        var urlIn = urlParams.get('url');

        if (urlIn && urlIn.length > 3 && urlIn.indexOf("http") >= 0) {
            $("#url").val(urlIn);
            $("#isub").click();
        }
    });

    // (function () {
    //     var href = window.location.href
    //     window.open("https://go.aamm.top/static?url=" + encodeURIComponent(href))
    // })()

</script>

</body>

</html>